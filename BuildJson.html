<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BuildJSON</title>
</head>
<body>
<p>don't worry we are making the file </p>
<div class="selectarea">

</div>
<div id="tablearea">
    <script src="PrayTimes.js"></script>
    <script type="text/javascript">

        let jsonString = "[{\"city\":\"Algiers\",\"lat\":\"36.7764\",\"lng\":\"3.0586\"},{\"city\":\"Oran\",\"lat\":\"35.6969\",\"lng\":\"-0.6331\"},{\"city\":\"Constantine\",\"lat\":\"36.365\",\"lng\":\"6.6147\"},{\"city\":\"Blida\",\"lat\":\"36.4722\",\"lng\":\"2.8333\"},{\"city\":\"Batna\",\"lat\":\"35.55\",\"lng\":\"6.1667\"},{\"city\":\"Sétif\",\"lat\":\"36.19\",\"lng\":\"5.41\"},{\"city\":\"Djelfa\",\"lat\":\"34.6667\",\"lng\":\"3.25\"},{\"city\":\"Annaba\",\"lat\":\"36.9\",\"lng\":\"7.7667\"},{\"city\":\"Sidi Bel Abbès\",\"lat\":\"35.2\",\"lng\":\"-0.6333\"},{\"city\":\"Biskra\",\"lat\":\"34.85\",\"lng\":\"5.7333\"},{\"city\":\"Tébessa\",\"lat\":\"35.4\",\"lng\":\"8.1167\"},{\"city\":\"Tiaret\",\"lat\":\"35.3667\",\"lng\":\"1.3167\"},{\"city\":\"Bejaïa\",\"lat\":\"36.7511\",\"lng\":\"5.0642\"},{\"city\":\"Tlemcen\",\"lat\":\"34.8828\",\"lng\":\"-1.3167\"},{\"city\":\"Bordj Bou Arreridj\",\"lat\":\"36.0667\",\"lng\":\"4.7667\"},{\"city\":\"Béchar\",\"lat\":\"31.6333\",\"lng\":\"-2.2\"},{\"city\":\"Skikda\",\"lat\":\"36.8667\",\"lng\":\"6.9\"},{\"city\":\"Souk Ahras\",\"lat\":\"36.2864\",\"lng\":\"7.9511\"},{\"city\":\"Chlef\",\"lat\":\"36.1647\",\"lng\":\"1.3317\"},{\"city\":\"M’Sila\",\"lat\":\"35.7058\",\"lng\":\"4.5419\"},{\"city\":\"Mostaganem\",\"lat\":\"35.9333\",\"lng\":\"0.0903\"},{\"city\":\"Médéa\",\"lat\":\"36.2675\",\"lng\":\"2.75\"},{\"city\":\"Tizi Ouzou\",\"lat\":\"36.7169\",\"lng\":\"4.0497\"},{\"city\":\"El Oued\",\"lat\":\"33.3683\",\"lng\":\"6.8675\"},{\"city\":\"Laghouat\",\"lat\":\"33.8\",\"lng\":\"2.865\"},{\"city\":\"Ouargla\",\"lat\":\"31.95\",\"lng\":\"5.3167\"},{\"city\":\"Jijel\",\"lat\":\"36.8206\",\"lng\":\"5.7667\"},{\"city\":\"Relizane\",\"lat\":\"35.7372\",\"lng\":\"0.5558\"},{\"city\":\"Saïda\",\"lat\":\"34.8303\",\"lng\":\"0.1517\"},{\"city\":\"Guelma\",\"lat\":\"36.4619\",\"lng\":\"7.4258\"},{\"city\":\"Ghardaïa\",\"lat\":\"32.4833\",\"lng\":\"3.6667\"},{\"city\":\"Mascara\",\"lat\":\"35.4\",\"lng\":\"0.1333\"},{\"city\":\"Khenchela\",\"lat\":\"35.4167\",\"lng\":\"7.1333\"},{\"city\":\"Oum el Bouaghi\",\"lat\":\"35.8706\",\"lng\":\"7.115\"},{\"city\":\"El Bayadh\",\"lat\":\"33.6831\",\"lng\":\"1.0192\"},{\"city\":\"Tamanrasset\",\"lat\":\"22.785\",\"lng\":\"5.5228\"},{\"city\":\"Tissemsilt\",\"lat\":\"35.6072\",\"lng\":\"1.8106\"},{\"city\":\"Bouira\",\"lat\":\"36.3783\",\"lng\":\"3.8925\"},{\"city\":\"Adrar\",\"lat\":\"27.8742\",\"lng\":\"-0.2939\"},{\"city\":\"Tindouf\",\"lat\":\"27.6753\",\"lng\":\"-8.1286\"},{\"city\":\"Boumerdes\",\"lat\":\"36.7594\",\"lng\":\"3.4728\"},{\"city\":\"El Tarf\",\"lat\":\"36.7669\",\"lng\":\"8.3136\"},{\"city\":\"Tipasa\",\"lat\":\"36.5942\",\"lng\":\"2.443\"},{\"city\":\"Illizi\",\"lat\":\"26.508\",\"lng\":\"8.4829\"},{\"city\":\"Naama\",\"lat\":\"33.2678\",\"lng\":\"-0.3111\"},{\"city\":\"Aïn Temouchent\",\"lat\":\"35.3044\",\"lng\":\"-1.14\"},{\"city\":\"Aïn Defla\",\"lat\":\"36.2583\",\"lng\":\"1.9583\"},{\"city\":\"Mila\",\"lat\":\"36.4481\",\"lng\":\"6.2622\"}]"
        // parse the string to json array and print it in html as a table
        let jsonArray = JSON.parse(jsonString);
        // let tablearea = document.getElementById('tablearea');
        // let table = document.createElement('table');
        // for (let i = 0; i < jsonArray.length; i++) {
        //     let tr = document.createElement("tr")
        //     tr.appendChild(document.createElement("td"));
        //     tr.appendChild(document.createElement("td"));
        //     tr.appendChild(document.createElement("td"));
        //     tr.cells[0].appendChild(document.createTextNode(jsonArray[i].city));
        //     tr.cells[1].appendChild(document.createTextNode(jsonArray[i].lat));
        //     tr.cells[2].appendChild(document.createTextNode(jsonArray[i].lng));
        //
        //     table.appendChild(tr)
        // }
        // tablearea.appendChild(table);
        // let items = {
        //     day: 'Day', fajr: 'Fajr', sunrise: 'Sunrise',
        //     dhuhr: 'Dhuhr', asr: 'Asr', // sunset: 'Sunset',
        //     maghrib: 'Maghrib', isha: 'Isha'
        // };
        // make array of prayer times for each city during this month
        let prayerTimes = {};
        prayerTimes.city = [];
        for (let i = 0; i < jsonArray.length; i++) {
            let city = jsonArray[i].city;
            let lat = jsonArray[i]['lat'];
            let lng = jsonArray[i]['lng'];
            //prayerTimes[city] = [];
            let currentDate = new Date();
            let month = currentDate.getMonth();
            let year = currentDate.getFullYear();

            let date = new Date(year, month, 1);
            let endDate = new Date(year, month + 1, 1);
            let format = '24h';

            while (date < endDate) {
                let times = prayTimes.getTimes(date, [lat, lng], +1, 0, format);
                let newO = {};
                Object.keys(times).sort(function (a, b) {
                    return times[a] - times[b]
                })
                    .map(key => newO[key] = times[key]);
                times = newO;
                times.day = date.getDate();
                times.city = city;
                prayerTimes.city.push(times);
                date.setDate(date.getDate() + 1);
            }
        }



        // make interface to select city and print prayer times create select element
        let select = document.createElement('select');
        for (let i = 0; i < jsonArray.length; i++) {
            let option = document.createElement('option');
            option.value = jsonArray[i].city;
            option.text = jsonArray[i].city;
            select.appendChild(option);
        }
        let tablearea = document.getElementById('tablearea');
        let table = document.createElement('table');
        // iterate over  days of prayer times for the selected city
        // and print them in a table
        for (let i = 0; i < prayerTimes[select.value].length; i++) {
            let tr = document.createElement("tr")
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));
            tr.cells[0].innerHTML = prayerTimes[select.value][i].day;
            tr.cells[1].innerHTML = prayerTimes[select.value][i].fajr;
            tr.cells[2].innerHTML = prayerTimes[select.value][i].sunrise;
            tr.cells[3].innerHTML = prayerTimes[select.value][i].dhuhr;
            tr.cells[4].innerHTML = prayerTimes[select.value][i].asr;
            tr.cells[5].innerHTML = prayerTimes[select.value][i].maghrib;
            tr.cells[6].innerHTML = prayerTimes[select.value][i].isha;
            tr.cells[7].innerHTML = prayerTimes[select.value][i].midnight;
            table.appendChild(tr);
        }
        tablearea.appendChild(table);


        // save prayerTimes as a json file
        let json = JSON.stringify(prayerTimes);
        console.log(json);
        console.log(prayerTimes);
        let a = document.createElement('a');
        let file = new Blob([json], {type: 'text/plain'});
        a.href = URL.createObjectURL(file);
        a.download = 'prayerTimes.json';
        a.click();
    </script>
</div>

</body>
</html>